<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美国手机号码筛重检测工具</title>
    <script>
        /* Tailwind 配置：在引入 CDN 之前定义更可靠 */
        window.tailwind = window.tailwind || {};
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        neutral: '#6B7280'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- SheetJS 用于 XLSX 支持 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- localForage 用于 IndexedDB 存储 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="./styles.css">
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 头部 -->
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">美国手机号码筛重检测工具</h1>
            <p class="text-gray-600">支持多格式导入/导出、批量合并、历史快照（本地保存）</p>
        </header>

        <!-- 工具栏：粘贴、导入、格式选项、导出字段、主题 -->
        <div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-3 md:space-y-0">
            <div class="flex items-center space-x-2">
                <label for="fileInput" class="inline-block bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg cursor-pointer transition-all duration-200">
                    <i class="fa fa-file-import mr-2"></i>选择文件
                </label>
                <input type="file" id="fileInput" accept=".txt,.csv,.xlsx,.xls" multiple class="hidden">

                <button id="pasteBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded-lg text-sm">
                    <i class="fa fa-clipboard mr-1"></i>粘贴号码
                </button>

                <select id="formatSelect" class="ml-2 px-3 py-2 border rounded-lg text-sm">
                    <option value="readable">格式：(123) 456-7890</option>
                    <option value="international">国际格式：+1 123-456-7890</option>
                    <option value="e164">纯数字：11234567890</option>
                </select>
            </div>

            <div class="flex items-center space-x-2">
                <button id="exportFieldsBtn" class="bg-primary text-white px-3 py-2 rounded-lg text-sm">导出字段</button>
                <button id="exportCsvBtn" class="bg-secondary text-white px-3 py-2 rounded-lg text-sm">导出 CSV</button>
                <button id="exportXlsxBtn" class="bg-secondary text-white px-3 py-2 rounded-lg text-sm">导出 XLSX</button>
                <button id="themeToggle" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded-lg text-sm">深色模式</button>
            </div>
        </div>

        <!-- 授权区域 -->
        <section id="authSection" class="mb-6 module p-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div>
                    <h3 class="font-semibold flex items-center">
                        <i class="fa fa-github text-gray-800 mr-2"></i>
                        数据存储授权（可选）
                    </h3>
                    <p class="text-sm text-gray-600 mt-1">验证 GitHub 可用于同步历史（默认保存到本地）</p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center w-full md:w-auto">
                    <input type="password" id="githubToken" placeholder="GitHub Personal Access Token（可选）" 
                           class="px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-sm w-full md:w-64">
                    <button id="verifyTokenBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-r-lg text-sm transition-colors">
                        验证
                    </button>
                </div>
            </div>
            <div id="tokenStatus" class="mt-2 text-sm hidden"></div>
        </section>

        <!-- 上传区（带拖拽） -->
        <section class="mb-6 module p-4">
            <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center transition-all duration-300">
                <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-3"></i>
                <p class="text-gray-600 mb-2">拖放文件到此处，或使用上方“选择文件 / 粘贴”</p>
                <p class="text-sm text-gray-500">支持 TXT、CSV、XLSX（可多选）。上传后会自动合并并去重。</p>
            </div>
            <div id="fileInfoWrap" class="mt-3"></div>
        </section>

        <!-- 预览与操作 -->
        <section class="mb-6">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold">导入预览（前 10 条）</h3>
                <div class="space-x-2">
                    <button id="selectAllDupBtn" class="text-sm text-gray-600">一键选择重复</button>
                    <button id="quickExportMobileBtn" class="text-sm text-gray-600">导出所有手机</button>
                </div>
            </div>
            <div id="previewWrap" class="bg-white p-3 rounded-lg shadow-sm">
                <table class="min-w-full text-sm" id="previewTable">
                    <thead>
                        <tr class="text-left text-gray-500 text-xs uppercase">
                            <th class="px-2 py-1">原始</th>
                            <th class="px-2 py-1">标准化</th>
                        </tr>
                    </thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>
        </section>

        <!-- 页脚 -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>© <span id="currentYear"></span> 美国手机号码筛重检测工具 | <a href="#" class="hover:text-primary">隐私政策</a> | <a href="#" class="hover:text-primary">使用条款</a></p>
            <p class="mt-2">历史默认保存到本地 IndexedDB，可选同步到 GitHub（需授权）</p>
        </footer>
    </div>

    <!-- 导出字段模态（简单实现） -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg w-11/12 max-w-md">
            <h4 class="font-medium mb-3">选择导出字段</h4>
            <div class="space-y-2 mb-3">
                <label class="flex items-center"><input type="checkbox" class="exportField" value="original" checked> <span class="ml-2">原始号码</span></label>
                <label class="flex items-center"><input type="checkbox" class="exportField" value="normalized" checked> <span class="ml-2">标准化号码</span></label>
                <label class="flex items-center"><input type="checkbox" class="exportField" value="carrier" checked> <span class="ml-2">运营商</span></label>
                <label class="flex items-center"><input type="checkbox" class="exportField" value="line_type" checked> <span class="ml-2">类型</span></label>
                <label class="flex items-center"><input type="checkbox" class="exportField" value="tags"> <span class="ml-2">标签</span></label>
            </div>
            <div class="flex justify-end space-x-2">
                <button id="closeExportModal" class="px-3 py-2 rounded bg-gray-100">取消</button>
                <button id="applyExportFields" class="px-3 py-2 rounded bg-primary text-white">应用并导出</button>
            </div>
        </div>
    </div>

    <!-- 应用脚本 -->
    <script src="./app.js"></script>
    <script>
        // 动态设置当前年份
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>
</body>
</html>
